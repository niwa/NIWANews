/*! NIWANews 14-03-2016 */
var news=angular.module("news",[]);news.controller("newsController",["$scope","newsService",function(a,b){a.model={headlineIds:[],nodeListRaw:[],nodeListSorted:[]},a.$watch("model.headlineIds",function(c,d){"undefined"!=typeof c&&0!==c.length&&b.getNodes(c).then(function(b){a.model.nodeListSorted=b})}),a.getLatestNodes=function(){b.getLatestNodeIds().then(function(b){a.model.headlineIds=b},function(b){a.model.nodeListSorted=!1})}}]),news.directive("latestNews",[function(){function a(a,b,c){a.getLatestNodes()}return{restrict:"EA",link:a,template:'<div id="niwaNews" class="panel panel-primary col-md-4"><div class="panel-heading"><h1 class="panel-title">Latest NIWA News </h1></div><div ng-repeat="node in model.nodeListSorted" class="body"><img width="100%" ng-show="$index==0" ng-src="{{node.nodeImage}}" /><h3>{{node.title}}</h3><p>{{node.summary}}</p></div></div></div></div>',controller:"newsController",scope:!1}}]),news.service("newsModelService",[function(){return{get:function(a){var b={};return b.contentType="forecast_article",b.imageBaseUrl="http://content-test.niwa.co.nz/sites/default/files/",b.headlinesUrl="http://content-test.niwa.co.nz/content/resource_list_by_type/"+b.contentType,b.nodeUrl="http://content-test.niwa.co.nz/content/node/",b.nodesAmount=10,"undefined"!=typeof b[a]?b[a]:"invalid parameter request"}}}]),news.service("newsService",["$http","$q","newsModelService",function(a,b,c){return{getLatestNodeIds:function(){var d=b.defer();return a({method:"GET",url:c.get("headlinesUrl")}).then(function(a){var b=a.data.titles.length,c=[];for(i=0;i<b;i++)c.push(a.data.titles[i].nid);d.resolve(c)},function(a){return"http  error"}),d.promise},getNodes:function(d){var e=function(a,b){return b.created-a.created},f=b.defer(),g=d.length<=10?d.length:10,h=1,j=[];for(i=0;i<g;i++)a({method:"GET",url:c.get("nodeUrl")+d[i]}).then(function(a){node={nid:a.data.nid,created:a.data.created,title:a.data.title,summary:a.data.body.und[0].summary,value:a.data.body.und[0].value,saveValue:a.data.body.und[0].safe_value,format:a.data.body.und[0].format,source:a.data.source,nodeImage:c.get("imageBaseUrl")+a.data.field_forecast_article_image.und[0].filename},h++,j.push(node),h>=g&&f.resolve(j.sort(e))},function(a){return"http error"});return f.promise}}}]);